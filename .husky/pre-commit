#!/usr/bin/env sh
###############################################################################
# Hook pre-commit Husky
#
# Ce hook s'ex√©cute avant chaque commit pour :
# 1. Formater et linter automatiquement les fichiers modifi√©s (lint-staged)
# 2. V√©rifier qu'aucune cl√© priv√©e √©vidente n'est sur le point d'√™tre commit√©e
#
# Si une erreur est d√©tect√©e, le commit est bloqu√©
###############################################################################
. "$(dirname -- "$0")/_/husky.sh"

# D√©tection basique de secrets/cl√©s priv√©es dans les fichiers staged
echo "üîç V√©rification de secrets potentiels..."
if git diff --cached --name-only | xargs grep -E "(PRIVATE_KEY|SECRET_KEY|API_KEY|PASSWORD).*=.*['\"][A-Za-z0-9]{20,}" 2>/dev/null; then
  echo "‚ö†Ô∏è  ATTENTION : Des cl√©s priv√©es potentielles ont √©t√© d√©tect√©es dans les fichiers staged !"
  echo "Veuillez v√©rifier que vous n'√™tes pas en train de committer des secrets."
  echo "Si c'est intentionnel (fichiers .example), vous pouvez utiliser --no-verify"
  exit 1
fi

npx lint-staged
